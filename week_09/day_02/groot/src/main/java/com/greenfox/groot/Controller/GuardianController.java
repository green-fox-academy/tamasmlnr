package com.greenfox.groot.Controller;


import com.greenfox.groot.MixtapeService.MixtapeService;
import com.greenfox.groot.Models.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
public class GuardianController {

  private MixtapeService mixtapeService;

  @Autowired
  public GuardianController(MixtapeService mixtapeService) {
    this.mixtapeService = mixtapeService;
  }

  @GetMapping("/groot")
  public ResponseEntity<?> groot(@RequestParam(value = "message", required = false) String message) {
    if (message == null)
      return ResponseEntity.status(HttpStatus.BAD_REQUEST)
          .body(new ErrorMessage("I am Groot!"));
    return ResponseEntity.status(HttpStatus.OK)
        .body(new GrootReply(message, "I am groot!"));
  }


  @GetMapping("/yondu")
  public ResponseEntity<?> yondu(@RequestParam(value = "distance", required = false) Double distance,
                                 @RequestParam(value = "time", required = false) Double time) {
    if (distance == null || time == null)
      return ResponseEntity.status(HttpStatus.BAD_REQUEST)
          .body(new ErrorMessage("Missing parameters!"));
    return ResponseEntity.status(HttpStatus.OK)
        .body(new YonduReply(distance, time));
  }

  @GetMapping("/awesome")
  public ResponseEntity<?> awesomeMix() {
    return ResponseEntity.status(HttpStatus.OK)
        .body(mixtapeService.findAllSongs());
  }

  @PutMapping("/awesome/add")
  public ResponseEntity<?> awesomeMixAddSong(@RequestParam(value = "author", required = false) String author,
                                             @RequestParam(value = "title", required = false) String title,
                                             @RequestParam(value = "genre", required = false) String genre,
                                             @RequestParam(value = "year", required = false) Integer year,
                                             @RequestParam(value = "rating", required = false) Double rating) {
    if (author.equals(null) || title.equals(null) || genre.equals(null) || year == 0 || rating == null) {
      return ResponseEntity.status(HttpStatus.BAD_REQUEST)
          .body(new ErrorMessage("Missing parameters!"));
    }
    mixtapeService.addSong(new Song(author, title, genre, year, rating));
    return ResponseEntity.status(HttpStatus.OK)
        .body(mixtapeService.findAllSongs());
    //for testing:
    //http://localhost:8080/awesome/add?author=Test&title=Test&genre=test&year=1990&rating=9.8
  }

  @DeleteMapping("/awesome/remove")
  public ResponseEntity<?> awesomeMixAddSong(@RequestParam(value = "author", required = false) String author,
                                             @RequestParam(value = "title", required = false) String title) {
    if (author.equals(null) || title.equals(null)) {
      return ResponseEntity.status(HttpStatus.BAD_REQUEST)
          .body(new ErrorMessage("Missing parameters!"));
    }
    mixtapeService.delete(mixtapeService.findSong(author, title));
    System.out.println(mixtapeService.findSong(author, title));
    return ResponseEntity.status(HttpStatus.OK)
        .body("Success!");
    //for testing:
    //http://localhost:8080/awesome/remove?author=Test&title=test
  }

  @PostMapping("/awesome/changerating")
  public ResponseEntity<?> awesomeMixAddSong(@RequestParam(value = "author", required = false) String author,
                                             @RequestParam(value = "title", required = false) String title,
                                             @RequestParam(value = "newrating", required = false) Double newrating) {
    if (author.equals(null) || title.equals(null)) {
      return ResponseEntity.status(HttpStatus.BAD_REQUEST)
          .body(new ErrorMessage("Missing parameters!"));
    }
    mixtapeService.changeRating(mixtapeService.findSong(author, title), newrating);
    return ResponseEntity.status(HttpStatus.OK)
        .body(mixtapeService.findAllSongs());
    //for testing:
    //http://localhost:8080/awesome/changerating?author=David Bowie&title=Starman&newrating=10
  }

  @GetMapping("/awesome/top/{top}")
  public ResponseEntity<?> topTracks(@PathVariable Integer top) {
    return ResponseEntity.status(HttpStatus.OK)
        .body(mixtapeService.findTop(top));
  }

}
